<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recyclage</title>

  <link rel="icon" href="../assets/img/favicon.ico" />
  <link rel="stylesheet" href="../assets/css/core.css" />
  <link rel="stylesheet" href="../assets/css/salvage.css" />
</head>

<body class="theme-neon">
  <div class="overlay">
    <div class="container page-salvage">

      <div class="header-actions">
        <a class="btn-ghost" href="../index.html" title="Retour au HUB">← HUB</a>
        <a class="btn-primary" href="https://discord.gg/d3Q5RJ35gr" target="_blank" rel="noopener noreferrer">
          <span class="badge badge-h">DISCORD</span> Support
        </a>
      </div>

      <h1 class="page-title">RECYCLAGE</h1>
      <div class="sub">Calcule la valeur générée par ton salvage (RMC et CMAT) — PU 4.4</div>

      <div class="mode-switch">
        <button id="btnBeginner" class="mode-btn is-active" type="button">Mode Débutant</button>
        <button id="btnAdvanced" class="mode-btn" type="button">Mode Avancé</button>
      </div>

      <div class="config-bar">
        <div class="config-left">
          <span class="pill">Configs</span>
          <select id="configSlot">
            <option value="slot1">Slot 1</option>
            <option value="slot2">Slot 2</option>
            <option value="slot3">Slot 3</option>
          </select>
          <input id="configName" type="text" maxlength="28" placeholder="Nom (optionnel)" />
        </div>
        <div class="config-right">
          <button id="btnLoadConfig" class="btn-ghost" type="button">Charger</button>
          <button id="btnSaveConfig" class="btn-ghost" type="button">Sauver</button>
        </div>
      </div>

      <!-- BEGINNER -->
      <section id="modeBeginner" class="panel section section-first">
        <div class="panel-title">Mode Débutant</div>

        <div class="grid-2-salvage" style="margin-top:10px;">
          <div class="panel inner-panel">
            <div class="panel-title panel-title-sm">Paramètres</div>

            <div class="form-row">
              <label for="shipSelect">Vaisseau</label>
              <select id="shipSelect"></select>
              <div class="ship-profile">
  <div class="panel-note panel-hint" id="shipNote"></div>
  <div class="panel-note panel-hint" id="begRefineHint" style="margin-top:6px; font-size: 15px;"></div>

  <div class="ship-profile-badge">
    <span id="shipProfileBadge" class="ship-badge ship-badge-off">—</span>
  </div>

  <div id="shipMetaHint" class="panel-note panel-hint ship-profile-meta">Profil : —</div>
</div>
            </div>

            <div class="form-row">
              <label for="scuRmc">SCU Hull Scraping (RMC)</label>
              <input id="scuRmc" type="number" inputmode="decimal" min="0" step="0.1" value="0" />
            </div>

            <div class="form-row">
              <label for="scuCmat">SCU Construction Salvage (CMR/CMS → CMAT)</label>
              <input id="scuCmat" type="number" inputmode="decimal" min="0" step="0.1" value="0" />
            </div>

            <div class="form-row">
              <label for="begLoopMinutes">Durée de boucle (minutes)</label>
              <input id="begLoopMinutes" type="number" inputmode="numeric" min="1" step="1" value="45" />
              <div class="panel-note panel-hint" style="margin-top:6px;">
                Sert à estimer un gain / heure 
              </div>
            </div>

            <div class="form-row">
              <label>Prix (aUEC / SCU) <span id="uexLockBadge" class="lock-badge" style="display:none;">UEX</span></label>
              <div class="inline-2">
                <div class="inline-field">
                  <span class="pill">RMC</span>
                  <input id="priceRmc" type="number" inputmode="decimal" min="0" step="0.01" value="0" />
                </div>
                <div class="inline-field">
                  <span class="pill">CMAT</span>
                  <input id="priceCmat" type="number" inputmode="decimal" min="0" step="0.01" value="0" />
                </div>
              </div>
              <div class="panel-note panel-hint" style="margin-top:8px;">
                Si UEX répond, les prix se remplissent automatiquement. Sinon, saisis-les manuellement.
              </div>
            </div>
            <div class="panel-note" style="margin-top:6px;"></div>

            <div class="panel-row" style="margin-top:10px;">
              <button id="btnRefreshUex" class="btn-ghost" type="button">Actualiser (UEX)</button>
              <button id="btnResetBeginner" class="btn-ghost" type="button">Réinitialiser</button>
            </div>
          </div>

          <div class="panel inner-panel">
            <div class="panel-title panel-title-sm">Résultats (live)</div>

            <div class="result-block">
              <div class="result-head">Résultat</div>

              <div class="result-hero">
                <div class="result-hero-label">Gain estimé</div>
                <div class="result-hero-value" id="outPerHourBig">0 aUEC/h</div>
              </div>

              <div class="result-line">
                <span>RMC vendu</span>
                <span id="outRmc">0 aUEC</span>
              </div>
              <div class="result-line">
                <span>CMAT vendu</span>
                <span id="outCmat">0 aUEC</span>
              </div>

              <div class="result-sep"></div>

              <div class="result-total">
                <span>Total</span>
                <span id="outTotal">0 aUEC</span>
              </div>

              <div class="result-line" style="margin-top:4px;">
                <span>Gain / heure</span>
                <span id="outPerHour">0 aUEC/h</span>
              </div>
              <div class="result-line">
                <span>Statut</span>
                <span id="outStatus" class="status-badge status-off">—</span>
              </div>
            </div>

            <div class="panel-note panel-hint" id="uexStatusLine" style="margin-top:10px;">
              UEX : statut inconnu.
            </div>
            <div class="panel-note panel-hint" id="uexLastUpdate" style="margin-top:6px; opacity:.85;">
              Dernière MAJ UEX : —
            </div>
          </div>
        </div>

        <div id="sellZonesPanel" class="panel inner-panel" style="margin-top:14px;">
          <div class="panel-title panel-title-sm">Top ventes (UEX)</div>
          <div class="panel-note">Mis à jour automatiquement si UEX répond.</div>

          <div class="top-sales-grid" style="margin-top:10px;">
            <div class="top-sales-card">
              <div class="top-sales-head">Top 3 — RMC</div>
              <div id="topRmc" class="top-sales-list"></div>
            </div>

            <div class="top-sales-card">
              <div class="top-sales-head">Top 3 — CMAT</div>
              <div id="topCmat" class="top-sales-list"></div>
            </div>
          </div>
        </div>

        <div class="panel inner-panel" style="margin-top:14px;">
            <div class="panel inner-panel" style="margin-top:14px;">
    <div class="panel-title panel-title-sm">Guide rapide (abréviations)</div>

    <div class="guide-grid">
      <div class="guide-card">
        <div class="guide-head">RMC</div>
        <div class="guide-text">
          <b>Recycled Material Composite</b> — provient du <b>grattage au laser</b> (hull scraping).<br/>
          <b>Vente directe</b> : pas de raffinage.
        </div>
      </div>

      <div class="guide-card">
        <div class="guide-head">CMR / CMS / CMAT</div>
        <div class="guide-text">
          Matériaux de construction obtenus via <b>désintégration</b> :
        </div>
        <ul class="guide-list" style="margin-top:8px;">
          <li><b>CMR</b> (granulés) : Salvation / Vulture / Fortune → <b>≈ 30 %</b> après raffinage.</li>
          <li><b>CMS</b> (morceaux) : Reclaimer → <b>≈ 15 %</b> après raffinage.</li>
          <li><b>CMAT</b> : résultat <b>après raffinage</b> (dans l’outil, on regroupe tout côté CMAT).</li>
        </ul>
      </div>

      <div class="guide-card">
        <div class="guide-head">Presets (vidéo)</div>
        <ul class="guide-list">
          <li><b>Salvation</b> : collecte très rapide → preset boucle <b>40 min</b>, raffinage <b>30 %</b>.</li>
          <li><b>Vulture / Fortune</b> : boucle plus longue → preset <b>55 min</b>, raffinage <b>30 %</b>.</li>
          <li><b>Reclaimer</b> : logistique lourde → preset <b>60 min</b>, raffinage <b>15 %</b>.</li>
        </ul>
      </div>
    </div>
  </div>
</section>

      <!-- ADVANCED -->
      <section id="modeAdvanced" class="panel section" style="display:none;">
        <div class="panel-title">Mode Avancé</div>

        <div class="grid-2-salvage" style="margin-top:10px;">
          <div class="panel inner-panel">
            <div class="panel-title panel-title-sm">Boucle & coûts</div>

            <div class="form-row">
              <label for="loopMinutes">Durée de boucle (minutes)</label>
              <input id="loopMinutes" type="number" inputmode="numeric" min="1" step="1" value="45" />
            </div>

            <div class="form-row">
              <label for="feesPct">Frais / pertes (%)</label>
              <input id="feesPct" type="number" inputmode="decimal" min="0" step="0.1" value="0" />
            </div>

            <div class="form-row">
              <label>Seuils de statut (aUEC / heure)</label>
              <div class="inline-2">
                <div class="inline-field">
                  <span class="pill">OK ≥</span>
                  <input id="thrOk" type="number" inputmode="numeric" min="0" step="1000" value="250000" />
                </div>
                <div class="inline-field">
                  <span class="pill">Bon ≥</span>
                  <input id="thrGood" type="number" inputmode="numeric" min="0" step="1000" value="500000" />
                </div>
              </div>
            </div>

            <div class="form-row">
              <label for="cmatRefineMode">CMAT</label>
              <select id="cmatRefineMode">
                <option value="sell">Vente directe (CMAT vendu tel quel)</option>
                <option value="refine">Raffinage (conversion CMAT → valeur raffinée)</option>
              </select>
            </div>

            <div class="form-row" id="refineBlock">
              <label for="cmatRefineYield">Rendement raffinage CMAT (%)</label>
              <input id="cmatRefineYield" type="number" inputmode="decimal" min="0" max="100" step="1" value="30" placeholder="Ex : 15 ou 30" />
            </div>
            <div class="panel-note" style="margin-top:6px;"></div>

            <div class="panel-row" style="margin-top:10px;">
              <button id="btnRefreshUexAdv" class="btn-ghost" type="button">Actualiser (UEX)</button>
              <button id="btnResetAdvanced" class="btn-ghost" type="button">Réinitialiser</button>
            </div>
          </div>

          <div class="panel inner-panel">
            <div class="panel-title panel-title-sm">Calcul détaillé</div>

            <div class="calc-table">
              <div class="calc-row calc-head">
                <div>Entrée</div>
                <div>Quantité</div>
                <div>Prix</div>
                <div>Valeur</div>
              </div>

              <div class="calc-row">
                <div>RMC</div>
                <div><input id="advScuRmc" type="number" inputmode="decimal" min="0" step="0.1" value="0" /></div>
                <div><input id="advPriceRmc" type="number" inputmode="decimal" min="0" step="0.01" value="0" /></div>
                <div id="advValRmc">0 aUEC</div>
              </div>

              <div class="calc-row">
                <div>CMAT</div>
                <div><input id="advScuCmat" type="number" inputmode="decimal" min="0" step="0.1" value="0" /></div>
                <div><input id="advPriceCmat" type="number" inputmode="decimal" min="0" step="0.01" value="0" /></div>
                <div id="advValCmat">0 aUEC</div>
              </div>

              <div class="calc-row calc-foot">
                <div>Total brut</div><div></div><div></div><div id="advGross">0 aUEC</div>
              </div>

              <div class="calc-row calc-foot">
                <div>Total net (après frais)</div><div></div><div></div><div id="advNet">0 aUEC</div>
              </div>

              <div class="calc-row calc-foot">
                <div>Profit / heure</div><div></div><div></div><div id="advPerHour">0 aUEC/h</div>
              </div>
            </div>

            <div class="panel-note panel-hint" id="uexStatusLineAdv" style="margin-top:10px;">
              UEX : statut inconnu.
            </div>
          </div>
        </div>

        <div class="panel inner-panel" style="margin-top:14px;">
          <div class="panel-title panel-title-sm">Résumé</div>
          <div class="summary-grid">
            <div class="summary-card">
              <div class="summary-label">Total net</div>
              <div class="summary-value" id="sumNet">0 aUEC</div>
            </div>
            <div class="summary-card">
              <div class="summary-label">Heures / run</div>
              <div class="summary-value" id="sumHours">0.00 h</div>
            </div>
            <div class="summary-card">
              <div class="summary-label">Net / heure</div>
              <div class="summary-value" id="sumPerHour">0 aUEC/h</div>
            </div>
            <div class="summary-card">
              <div class="summary-label">Statut</div>
              <div class="summary-value"><span id="sumStatus" class="status-badge status-off">—</span></div>
<div class="adv-selected-sale">
  <div class="adv-selected-label">Vente sélectionnée</div>
  <div class="adv-selected-value" id="advSelectedSale">—</div>
  <button class="btn-ghost btn-copy" id="btnCopySale" type="button" title="Copier le terminal">Copier</button>
</div>
            </div>
          </div>
        </div>
      
<div class="panel inner-panel" id="advPriceHistoryPanel" style="margin-top:14px;">
  <div class="panel-title panel-title-sm">Historique des prix (UEX)</div>
  <div class="panel-note">Courbes sur les derniers points connus. </div>

  <div class="chart-wrap">
    <canvas id="advPriceHistoryChart" class="chart-canvas" width="640" height="260"></canvas>
            <div id="advChartTooltip" class="chart-tooltip" aria-hidden="true"></div>
    <div class="chart-legend">
      <span class="lg-item"><span class="lg-dot lg-rmc"></span>RMC</span>
      <span class="lg-item"><span class="lg-dot lg-cmat"></span>CMAT</span>
    </div>
  </div>

  <div class="chart-foot">
    <button class="btn-ghost" id="btnChartRefreshAdv" type="button">Rafraîchir</button>
    <span class="muted" id="advChartStatus">—</span>
  </div>
</div>
</section>

      <div class="app-footer-brand">Recyclage • V1.4.8b • MAJ : 14/12/2025</div>
    </div>
  </div>

  <script src="../assets/js/core.js" defer></script>
  <script src="../assets/js/uex-token.js" defer></script>
  <script src="../assets/js/salvage.js" defer></script>
</body>
</html>